<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pocket Lawyer - ‡§Ü‡§™‡§ï‡§æ ‡§ï‡§æ‡§®‡•Ç‡§®‡•Ä ‡§∏‡§æ‡§•‡•Ä</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        :root { --primary: #1a365d; --accent: #c05621; --bg: #f7fafc; }
        body { font-family: system-ui; background: var(--bg); margin: 0; display: flex; flex-direction: column; min-height: 100vh; }
        
        .top-header { background: white; border-bottom: 2px solid var(--primary); padding: 15px 20px; position: fixed; top: 0; width: 100%; z-index: 1000; font-weight: 800; color: var(--primary); font-size: 1.4rem; }
        
        .main-container { margin-top: 80px; padding: 20px; padding-bottom: 160px; max-width: 800px; margin-inline: auto; width: 100%; }
        
        .chat-box { display: flex; flex-direction: column; gap: 15px; }
        .message { max-width: 85%; padding: 12px 18px; border-radius: 15px; line-height: 1.6; }
        .user-message { align-self: flex-end; background: var(--primary); color: white; border-bottom-right-radius: 2px; }
        .ai-message { align-self: flex-start; background: white; border: 1px solid #e2e8f0; border-bottom-left-radius: 2px; }
        
        /* WHATSAPP BOUNCE */
        .typing-indicator { display: none; margin: 10px 0; }
        .dot { height: 8px; width: 8px; background: #cbd5e0; border-radius: 50%; display: inline-block; margin: 0 2px; animation: bounce 1.4s infinite ease-in-out both; }
        .dot:nth-child(1) { animation-delay: -0.32s; }
        .dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }

        .input-area { position: fixed; bottom: 0; left: 0; width: 100%; background: white; border-top: 1px solid #e2e8f0; padding: 15px 0; }
        .input-wrapper { max-width: 800px; margin: 0 auto; display: flex; gap: 10px; width: 90%; }
        input { flex: 1; padding: 14px; border-radius: 25px; border: 1px solid #cbd5e0; outline: none; }
        button#send { background: var(--primary); color: white; border: none; width: 48px; height: 48px; border-radius: 50%; cursor: pointer; }
        
        .pdf-btn { background: var(--accent); color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; margin-top: 10px; display: block; }
    </style>
</head>
<body>

    <header class="top-header">‚öñÔ∏è Pocket Lawyer</header>

    <div class="main-container">
        <div id="landing-page">
            <h1 style="color: var(--primary);">‡§®‡§Æ‡§∏‡•ç‡§§‡•á, ‡§Æ‡•à‡§Ç ‡§π‡•Ç‡§Å Pocket Lawyer</h1>
            <p>‡§Æ‡•à‡§Ç ‡§≠‡§æ‡§∞‡§§‡•Ä‡§Ø ‡§ï‡§æ‡§®‡•Ç‡§®‡•ã‡§Ç ‡§ï‡•ã ‡§∏‡§Æ‡§ù‡§®‡•á ‡§î‡§∞ ‡§≤‡•Ä‡§ó‡§≤ ‡§°‡•ç‡§∞‡§æ‡§´‡•ç‡§ü ‡§¨‡§®‡§æ‡§®‡•á ‡§Æ‡•á‡§Ç ‡§Ü‡§™‡§ï‡•Ä ‡§Æ‡§¶‡§¶ ‡§ï‡§∞‡•Ç‡§Å‡§ó‡§æ‡•§</p>
            <div style="background: white; padding: 15px; border-radius: 10px; border-left: 4px solid var(--accent); font-size: 0.9rem;">
                <b>‡§â‡§¶‡§æ‡§π‡§∞‡§£:</b> "‡§Æ‡•á‡§∞‡§æ Amazon ‡§∞‡§ø‡§´‡§Ç‡§° ‡§´‡§Å‡§∏‡§æ ‡§π‡•à", "FIR ‡§ï‡•à‡§∏‡•á ‡§ï‡§∞‡§æ‡§ä‡§Ç?", "‡§Æ‡§ï‡§æ‡§® ‡§Æ‡§æ‡§≤‡§ø‡§ï ‡§®‡•ã‡§ü‡§ø‡§∏"
            </div>
        </div>

        <div id="chat-box" class="chat-box"></div>
        <div id="typing-indicator" class="typing-indicator">
            <span class="dot"></span><span class="dot"></span><span class="dot"></span>
        </div>
    </div>

    <div class="input-area">
        <div class="input-wrapper">
            <input type="text" id="user-input" placeholder="‡§Ö‡§™‡§®‡•Ä ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§≤‡§ø‡§ñ‡•á‡§Ç..." onkeypress="if(event.key==='Enter') sendMessage()">
            <button id="send" onclick="sendMessage()">‚û§</button>
        </div>
    </div>

<script>
    const chatBox = document.getElementById("chat-box");
    const landing = document.getElementById("landing-page");
    const typing = document.getElementById("typing-indicator");

    async function sendMessage() {
        const input = document.getElementById("user-input");
        const text = input.value.trim();
        if(!text) return;

        landing.style.display = "none";
        addMessage(text, "user-message");
        input.value = "";
        typing.style.display = "block";

        try {
            const res = await fetch("/chat", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ message: text, session_id: "user123" })
            });
            const data = await res.json();
            typing.style.display = "none";
            addMessage(data.reply, "ai-message");
        } catch(e) { 
            typing.style.display = "none";
            addMessage("Error connecting to server.", "ai-message");
        }
    }

    function addMessage(text, className) {
        const div = document.createElement("div");
        div.classList.add("message", className);
        
        if(className === 'ai-message') {
            div.innerHTML = marked.parse(text);
            // PDF Button for drafts
            if(text.length > 100) {
                const b = document.createElement("button");
                b.className = "pdf-btn";
                b.innerText = "üìÑ Download PDF";
                b.onclick = () => downloadPDF(text);
                div.appendChild(b);
            }
        } else { div.textContent = text; }

        chatBox.appendChild(div);
        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    }

    async function downloadPDF(content) {
        const res = await fetch('/generate_pdf', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ content })
        });
        const blob = await res.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = 'Legal_Draft.pdf';
        a.click();
    }
</script>
</body>
</html>
