<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pocket Lawyer</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        :root { --primary: #1a365d; --accent: #c05621; --bg: #f7fafc; }
        body { font-family: system-ui, sans-serif; background: var(--bg); margin: 0; padding-bottom: 100px; }
        .top-header { background: white; border-bottom: 2px solid var(--primary); padding: 15px 20px; position: fixed; top: 0; width: 100%; z-index: 1000; font-weight: 800; color: var(--primary); }
        .main-container { margin-top: 80px; padding: 20px; max-width: 800px; margin-inline: auto; }
        .chat-box { display: flex; flex-direction: column; gap: 20px; }
        .message { padding: 15px; border-radius: 12px; line-height: 1.6; background: white; border: 1px solid #e2e8f0; }
        .user-message { align-self: flex-end; background: var(--primary); color: white; border-bottom-right-radius: 0; }
        .ai-message { align-self: flex-start; border-bottom-left-radius: 0; width: 100%; }
        
        /* Action Box - Right Aligned */
        .message-actions { display: flex; justify-content: flex-end; gap: 10px; margin-top: 15px; padding-top: 10px; border-top: 1px solid #f1f5f9; }
        .action-btn { background: #f8fafc; border: 1px solid #e2e8f0; padding: 6px 12px; border-radius: 6px; font-size: 13px; cursor: pointer; display: flex; align-items: center; gap: 5px; }
        .action-btn:hover { background: #edf2f7; color: var(--primary); }

        .input-area { position: fixed; bottom: 0; width: 100%; background: white; padding: 15px; border-top: 1px solid #e2e8f0; }
        .input-wrapper { max-width: 800px; margin: 0 auto; display: flex; gap: 10px; }
        input { flex: 1; padding: 12px 20px; border-radius: 25px; border: 1px solid #cbd5e0; outline: none; }
        button#send { background: var(--primary); color: white; border: none; width: 45px; height: 45px; border-radius: 50%; cursor: pointer; }
        
        .typing { display: none; font-size: 14px; color: #718096; margin: 10px 0; }
    </style>
</head>
<body>
    <header class="top-header">‚öñÔ∏è Pocket Lawyer</header>
    <div class="main-container">
        <div id="chat-box" class="chat-box"></div>
        <div id="typing" class="typing">‡§™‡•â‡§ï‡•á‡§ü ‡§≤‡•â‡§Ø‡§∞ ‡§∏‡•ã‡§ö ‡§∞‡§π‡§æ ‡§π‡•à...</div>
    </div>
    <div class="input-area">
        <div class="input-wrapper">
            <input type="text" id="user-input" placeholder="‡§Ö‡§™‡§®‡•Ä ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§Ø‡§π‡§æ‡§Å ‡§≤‡§ø‡§ñ‡•á‡§Ç..." onkeypress="if(event.key==='Enter') sendMessage()">
            <button id="send" onclick="sendMessage()">‚û§</button>
        </div>
    </div>

<script>
    async function sendMessage() {
        const input = document.getElementById("user-input");
        const text = input.value.trim();
        if(!text) return;
        addMessage(text, "user-message");
        input.value = "";
        document.getElementById("typing").style.display = "block";

        const res = await fetch("/chat", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message: text, session_id: "user1" })
        });
        const data = await res.json();
        document.getElementById("typing").style.display = "none";
        addMessage(data.reply, "ai-message");
    }

    function addMessage(text, className) {
        const div = document.createElement("div");
        div.classList.add("message", className);
        
        if(className === 'ai-message') {
            div.innerHTML = marked.parse(text);
            
            // Smart Check: Only show buttons for formal drafts/notices
            const isDraft = text.toLowerCase().includes('subject:') || 
                            text.toLowerCase().includes('to:') || 
                            text.toLowerCase().includes('dear');

            if (isDraft) {
                const actions = document.createElement("div");
                actions.className = "message-actions";
                
                const copy = document.createElement("button");
                copy.className = "action-btn";
                copy.innerHTML = "üìã Copy";
                copy.onclick = () => {
                    navigator.clipboard.writeText(text);
                    copy.innerHTML = "‚úÖ Copied";
                    setTimeout(() => copy.innerHTML = "üìã Copy", 2000);
                };

                const pdf = document.createElement("button");
                pdf.className = "action-btn";
                pdf.innerHTML = "üìÑ PDF";
                pdf.onclick = () => downloadPDF(text);

                actions.appendChild(copy);
                actions.appendChild(pdf);
                div.appendChild(actions);
            }
        } else { div.textContent = text; }

        document.getElementById("chat-box").appendChild(div);
        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    }

    async function downloadPDF(content) {
        const res = await fetch('/generate_pdf', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ content })
        });
        const blob = await res.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = 'Pocket_Lawyer_Draft.pdf';
        a.click();
    }
</script>
</body>
</html>
